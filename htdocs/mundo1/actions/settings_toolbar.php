<?php$standard_toolbar = array(	array (		'obrazek' => '/ds_graphic/buildings/main.png',		'nazwa' => 'Edificio principal',		'link' => 'game.php?village=[akuvillage]&amp;screen=main'		),	array (		'obrazek' => '/ds_graphic/buildings/barracks.png',		'nazwa' => 'Quartel',		'link' => 'game.php?village=[akuvillage]&amp;screen=barracks'		),	array (		'obrazek' => '/ds_graphic/buildings/stable.png',		'nazwa' => 'Estabulo',		'link' => 'game.php?village=[akuvillage]&amp;screen=stable'		),	array (		'obrazek' => '/ds_graphic/buildings/garage.png',		'nazwa' => 'Oficina',		'link' => 'game.php?village=[akuvillage]&amp;screen=garage'		),	array (		'obrazek' => '/ds_graphic/buildings/snob.png',		'nazwa' => 'Academia',		'link' => 'game.php?village=[akuvillage]&amp;screen=snob'		),	array (		'obrazek' => '/ds_graphic/buildings/smith.png',		'nazwa' => 'Ferreiro',		'link' => 'game.php?village=[akuvillage]&amp;screen=smith'		),	array (		'obrazek' => '/ds_graphic/buildings/place.png',		'nazwa' => 'Praça',		'link' => 'game.php?village=[akuvillage]&amp;screen=place'		),	array (		'obrazek' => '/ds_graphic/buildings/market.png',		'nazwa' => 'Mercado',		'link' => 'game.php?village=[akuvillage]&amp;screen=market'		),	array (		'obrazek' => '/ds_graphic/buildings/barracks.png',		'nazwa' => 'Recrutamento',		'link' => 'game.php?village=[akuvillage]&amp;screen=train'		)	);		if ($_GET['action'] === 'del_tool') {	if ($_GET['h'] == $session['hkey']) {		$_GET['id'] = (int)$_GET['id'];		$_GET['id'] = floor($_GET['id']);				foreach ($toolbar_array as $key => $tool) {			if ($key != $_GET['id']) {				$toolbar_new_array[] = $tool;				}			}					$toolbar_new_array = serialize($toolbar_new_array);		mysql_query("UPDATE `users` SET `toolbar` = '".$toolbar_new_array."' WHERE `id` = '".$user['id']."'");			header('location: game.php?village='.$village['id'].'&screen=settings&mode=toolbar');		exit;		} else {		$error = 'Erro ao executar a ao';		}	}	if ($_GET['action'] === 'reset_toolbar') {	if ($_GET['h'] == $session['hkey']) {		mysql_query("UPDATE `users` SET `toolbar` = '".serialize($standard_toolbar)."' WHERE `id` = '".$user['id']."'");		header('location: game.php?village='.$village['id'].'&screen=settings&mode=toolbar');		exit;		}	}	if ($_GET['action'] === 'replace_down') {	if ($_GET['h'] == $session['hkey']) {		$_GET['id'] = (int)$_GET['id'];		$_GET['id'] = floor($_GET['id']);				if (!is_array($toolbar_array[$_GET['id'] + 1])) {			$error = 'Nie mona przesun';			} else {			$last_value = $toolbar_array[$_GET['id'] + 1];			$toolbar_array[$_GET['id'] + 1] = $toolbar_array[$_GET['id']];			$toolbar_array[$_GET['id']] = $last_value;						$toolbar_new_array = serialize($toolbar_array);			mysql_query("UPDATE `users` SET `toolbar` = '".$toolbar_new_array."' WHERE `id` = '".$user['id']."'");				header('location: game.php?village='.$village['id'].'&screen=settings&mode=toolbar');			exit;			}		} else {		$error = 'Erro ao executar a ao';		}	}	if ($_GET['action'] === 'replace_up') {	if ($_GET['h'] == $session['hkey']) {		$_GET['id'] = (int)$_GET['id'];		$_GET['id'] = floor($_GET['id']);				if (!is_array($toolbar_array[$_GET['id'] - 1])) {			$error = 'No pode ser movido';			} else {			$next_value = $toolbar_array[$_GET['id'] - 1];			$toolbar_array[$_GET['id'] - 1] = $toolbar_array[$_GET['id']];			$toolbar_array[$_GET['id']] = $next_value;						$toolbar_new_array = serialize($toolbar_array);			mysql_query("UPDATE `users` SET `toolbar` = '".$toolbar_new_array."' WHERE `id` = '".$user['id']."'");				header('location: game.php?village='.$village['id'].'&screen=settings&mode=toolbar');			exit;			}		} else {		$error = 'Erro ao executar a ao';		}	}	if ($_GET['action'] === 'add_tolbar' && count($_POST) > 0) {	if ($_GET['h'] == $session['hkey']) {		//Walidacja:		$_POST['name'] = cmp_str($_POST['name'],3,25);		$_POST['img_link'] = cmp_str($_POST['img_link'],5,150);		$_POST['link'] = cmp_str($_POST['link'],5,150);				if ($_POST['name'] === 'SHORT') {			$error = 'Nazwa musi skaada si co najmniej z 3 znakw.';			}		elseif ($_POST['name'] === 'LONG') {			$error = 'Nazwa moe maksymalnie skada si z 25 znakw.';			}		elseif ($_POST['name'] === 'SPACES') {			$error = 'Nazwa nie moe skada si z samych spacji.';			}					if ($_POST['img_link'] === 'SHORT') {			$error = 'Link obrazka musi skaada si co najmniej z 5 znakw.';			}		elseif ($_POST['img_link'] === 'LONG') {			$error = 'Link obrazka moe maksymalnie skada si z 150 znakw.';			}		elseif ($_POST['img_link'] === 'SPACES') {			$error = 'Link obrazka nie moe skada si z samych spacji.';			}					if ($_POST['link'] === 'SHORT') {			$error = 'Link musi skaada si co najmniej z 5 znakw.';			}		elseif ($_POST['link'] === 'LONG') {			$error = 'Link moe maksymalnie skada si z 150 znakw.';			}		elseif ($_POST['link'] === 'SPACES') {			$error = 'Link nie moe skada si z samych spacji.';			}								if (empty($error)) {			$toolbar_array[] = array('obrazek' => $_POST['img_link'],'nazwa' => $_POST['name'],'link' => $_POST['link']);						$toolbar_new_array = serialize($toolbar_array);			mysql_query("UPDATE `users` SET `toolbar` = '".$toolbar_new_array."' WHERE `id` = '".$user['id']."'");						header('location: game.php?village='.$village['id'].'&screen=settings&mode=toolbar');			exit;			}		} else {		$error = 'Bd podczas wykonywania akcji';		}	}$tpl->assign('toolbar_array',$toolbar_array);$tpl->assign('error',$error);?>