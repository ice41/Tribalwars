/*9a9d3533dc90a393f5df610458e57146*/
var BuildingMain={upgrade_building_link:'',downgrade_building_link:'',link_reduce_buildtime:'',link_cancel:'',confirm_queue:false,confirm_builtime_reduce:true,mode:0,request_id:0,last_request_id:0,init:function(){UI.ToolTip($('.tooltip'))},init_buildqueue:function(url){$("#buildqueue").sortable({axis:'y',handle:'.bqhandle',stop:function(event,ui){var el=ui.item;$.ajax({dataType:'json',type:'get',url:url,data:$("#buildqueue").sortable('serialize'),success:function(data){if(data.error){UI.InfoMessage(data.error,2000,true);$("#buildqueue").sortable('cancel');return};BuildingMain.init_buildqueue(url);BuildingMain.update_all(data)}})}});$("#buildqueue").sortable('option','items','.sortable_row')},init_mobilebuildqueue:function(url){MDS.orderableQueue.init($('#buildqueue_wrap').find('div').first(),url,function(data){BuildingMain.update_all(data)})},build:function(building_id,cheap){var updateBuildQueue=function(){var current_request_id=++BuildingMain.request_id,data={id:building_id,force:1,destroy:BuildingMain.mode,source:game_data.village.id};if(typeof cheap!="undefined")data.cheap=1;$.ajax({url:BuildingMain.mode==0?BuildingMain.upgrade_building_link:BuildingMain.downgrade_building_link,dataType:'json',data:data,success:function(build_ret){if(build_ret.error){UI.ErrorMessage(build_ret.error,2000)}else if(build_ret.success&&current_request_id>BuildingMain.last_request_id){BuildingMain.last_request_id=current_request_id;BuildingMain.update_all(build_ret);if(mobile)UI.SuccessMessage('Polecenie budowy zostaĹo pomyĹlnie dodane do kolejki.')}}})};if(BuildingMain.confirm_queue&&this.mode==0){var msg='Polecenia budowy w kolejce kosztujÄ wiÄcej. Mimo wszystko budowaÄ?',buttons=[{text:"OK",callback:updateBuildQueue,confirm:true}];UI.ConfirmationBox(msg,buttons)}else updateBuildQueue();return false},destroy:function(building_id){return BuildingMain.build(building_id)},build_reduced:function(check_pp_link,confirm_text,link){if(!Premium.checkPP(check_pp_link))return false;var confirmChangeOrderCallback=function(){document.location.replace(link)},buttons=[{text:'OK',callback:confirmChangeOrderCallback,confirm:true}];UI.ConfirmationBox(confirm_text,buttons);return false},cancel:function(order_id,spent_pp){var msg;if(spent_pp){msg='Czy naprawdÄ chcesz anulowaÄ zleconÄ operacjÄ? Anulowanie budowy nie spowoduje zwrotu Ĺźadnych punktĂłw premium wydanych na niÄ.'}else msg='Czy naprawdÄ chcesz anulowaÄ zleconÄ operacjÄ?';var cancelBuildingCallback=function(){$.ajax({dataType:'json',type:'get',url:BuildingMain.link_cancel,data:{id:order_id,destroy:BuildingMain.mode},success:function(data){BuildingMain.update_all(data)}})},buttons=[{text:'OK',callback:cancelBuildingCallback,confirm:true}];UI.ConfirmationBox(msg,buttons);return false},change_order:function(order_id,confirm_reduction,check_pp_link,confirm_text){if(confirm_reduction&&!Premium.checkPP(check_pp_link))return false;var confirmChangeOrderCallback=function(){$.ajax({dataType:'json',type:'get',url:BuildingMain.link_change_order,data:{id:order_id,destroy:BuildingMain.mode},success:function(data){if(data.hasOwnProperty('error')){UI.ErrorMessage(data.error)}else BuildingMain.update_all(data)}})};if(!confirm_reduction){confirmChangeOrderCallback();return};var buttons=[{text:'OK',callback:confirmChangeOrderCallback,confirm:true}];UI.ConfirmationBox(confirm_text,buttons);return false},update_all:function(data){if(data.reload){document.location.reload();return};var queue_wrapper=$('#buildqueue_wrap');if(queue_wrapper.length==1){if(data.building_orders){queue_wrapper.replaceWith(data.building_orders)}else queue_wrapper.remove()}else $('#building_wrapper').before(data.building_orders);if(data.next_buildings){$('#building_wrapper').replaceWith(data.next_buildings);UI.ToolTip($('.tooltip'));$('.inactive img').fadeTo(0,.5)};if(typeof data.confirm_queue!='undefined')BuildingMain.confirm_queue=data.confirm_queue;if(data.resources){setRes('wood',data.resources[0]);setRes('stone',data.resources[1]);setRes('iron',data.resources[2])};if(typeof data.population!='undefined')$('#pop_current_label').html(data.population);startTimer();if(typeof QuestArrows!='undefined')QuestArrows.init()}}
function set_show_all_buildings(url){$('.togglerow').toggle();$.ajax({type:"POST",url:url,data:{show_all_buildings:$('#show_all_buildings').is(':checked')}});return false}
function hide_completed(url){$.ajax({type:"POST",url:url,data:{hide_completed:$('#hide_completed').is(':checked')},success:function(response){location.reload()}});return false}